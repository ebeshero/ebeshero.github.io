
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml">
   
   	
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <link rel="stylesheet" type="text/css" href="explain.css" />
      <title>XQuery Exercise 1</title>
   </head>
   
   
   
   <body>
      <!--#include virtual="top.html" -->
      	
      		
      <h1><span class="banner">XQuery Exercise 1</span></h1>
      		    		
      			
      <p>For our first XQuery exercise we’ll be working with a collection of Shakespeare’s
         plays (actually <em>not</em> coded in TEI). We have uploaded these into <a href="http://dxcvm05.psc.edu:8080/">our eXist XML database</a>, and you can locate them in this collection: <code>collection('/db/shakespeare/plays')</code></p>
      			
      <p>Write XQuery expressions for each of the following tasks using the eXide window in our eXist database, and test them by hitting the <q>Eval</q> button. Then paste your XQuery expressions into a text
         file, adding comments as needed. You will be submitting your text file to Courseweb. 
      </p>
      			
      <ol>
         			
         <li>Find all of the titles of all of the Shakespeare plays in the collection. You will
            need to read our <strong><a href="explainXQuery.html">Guide to XQuery and eXist</a></strong> for information about how to address the collection of plays. The Guide will also
            help you figure out  how to retrieve the full text of one of the plays so that you
            can look at it and see where the <code>&lt;TITLE&gt;</code> element is, which you will need to know in order to construct the XPath to retrieve
            it. The simplest answer is a single XPath expression. The output should look something
            like:
            			  
            <pre>
               &lt;TITLE&gt;The Tragedy of Hamlet, Prince of Denmark&lt;/TITLE&gt; 
               &lt;TITLE&gt;The Tragedy of Macbeth&lt;/TITLE&gt; 
               &lt;TITLE&gt;The Tragedy of Romeo and Juliet&lt;/TITLE&gt;
            </pre>
            			  
         </li>
         			
         <li>Modify your XPath above to return just the text of the titles, without the tags. You
            can do that by using <code>text() </code>or <code>data() </code>or <code>string()</code> . Your output should look something like:
            
            <pre>
               The Tragedy of Hamlet, Prince of Denmark
               The Tragedy of Macbeth
               The Tragedy of Romeo and Juliet
            </pre>
            			
         </li>
         				
         				
         				
         <li>Find the play that contains a count of more than 40 unique (distinct) speakers and
            then return its <code>&lt;TITLE&gt;</code> element. You will need to use <code>count()</code> and <code>distinct-values()</code>, and you’ll need a construction involving 
            <strong>count(of something) gt 40</strong> . 
            				<p>Find the collection, drill down to the <code>&lt;PLAY&gt;</code> elements in the collection (you know there are three of them), then filter them based
            on whether or not they contain more than 40 <code>&lt;SPEAKER&gt;</code> elements. Once you’re getting the one play that meets that description, you can add
            a path step to retrieve its <code>&lt;TITLE&gt;</code>.</p> 
            				 
            			  
         </li>
         				
         <li><ul><li>Modify your solution to the preceding question #3 to return <strong>just the text of the play title, without the &lt;TITLE&gt; tags</strong>. You can take the same approach that you did for the transition from question #1 to question #2.</li>
            <li>When retrieving a single file from a collection, the <code>base-uri()</code> function can be useful. Try appending <code>base-uri()</code> to your XQuery expression and run it: What result do you see in the output window, and what is it telling you? </li>
            <li>What if we wanted only to return the <strong>file name with its file extension</strong> after the last forward slash (<code>/</code>) in the preceding results of <code>base-uri()</code>? How could we remove the previous string of text in our output? We would use the <code>tokenize()</code> function (which you can look up on at the <a href="http://www.w3schools.com/xsl/xsl_functions.asp">w3schools list of XPath functions</a> or in the Michael Kay book). That function breaks apart a string of text by dividing it at a particular regex pattern, and in this case the pattern is the forward slash. The <code>tokenize()</code> function returns <em>tokens</em> or broken-off pieces of a string: each chunk before and after the regex you enter. In order to isolate <em>just</em> the piece we want, we can identify the pieces by their position in the sequence of broken pieces: is it the first token, the second, the third, or the last one, whatever it is? To retrieve the first token, after you run the tokenize function, you can place a predicate holding the position value: <code>[1]</code>, <code>[2]</code>, etc. To retrieve <em>the last item</em> in a series, without knowing its numerical position, you can use the <code>last()</code> function (which you can read about in the same resources we mentioned above or in <q><a href="http://dh.obdurodon.org/functions.xhtml">The Xpath functions we use the most</a></q>). Note that nothing goes inside the parentheses in <code>last()</code>. With this information, then, how would you write your XQuery to return just the last part of the results of the <code>base-uri()</code> function, the part that appears after the last forward slash character? Record your expression. </li>
         </ul>			
         </li>
         			  
         <li><strong>FLWOR Statement or XPath expression?:</strong> Did you write your XQuery for number 4 with a long XPath expression (from left to
            right)? Or did you write it up as a FLWOR statement? (Review <a href="explainXQuery.html">our tutorial</a> for details and examples on writing FLWOR statements using variables.) Whichever way you chose to write your XQuery in the previous steps, try the <em>other</em> way and see if you can duplicate your results. Record your XQuery expressions in your text file. 
         </li>
         			
      </ol>
      		
      	<p>When you have completed the assignment upload your text file containing your XQuery expressions to Courseweb.</p>
   </body>
   
   
   
   
</html>